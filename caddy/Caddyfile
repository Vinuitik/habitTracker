## Caddyfile for HabitTracker

# Optional: Use Let's Encrypt staging during initial setup to avoid rate limits
# Uncomment the block below temporarily if needed, then comment it out for production.
# {
# 	acme_ca https://acme-staging-v02.api.letsencrypt.org/directory
# }

# Primary HTTPS sites (automatic certificates by Caddy)
habitrackerdima.me, www.habitrackerdima.me {
	encode zstd gzip

	# Proxy to internal Nginx (which proxies to the Java app)
	reverse_proxy nginx:80 {
		header_up Host {host}
		header_up X-Real-IP {remote_host}
		header_up X-Forwarded-For {remote_host}
		header_up X-Forwarded-Proto "https"
	}
}

# HTTP listener
# - If the host matches the real domain(s), redirect to HTTPS
# - Otherwise (e.g., local dev without domain), just proxy over HTTP
:80 {
	@this host habitrackerdima.me www.habitrackerdima.me
	handle @this {
		redir https://{host}{uri} permanent
	}

	handle {
		reverse_proxy nginx:80
	}
}
