## Caddyfile for HabitTracker

# Primary HTTPS site for your domain (automatic certificates by Caddy)
habitrackerdima.me {
	encode zstd gzip

	# Proxy to internal Nginx (which proxies to the Java app)
	reverse_proxy nginx:80 {
		header_up Host {host}
		header_up X-Real-IP {remote_host}
		header_up X-Forwarded-For {remote_host}
		header_up X-Forwarded-Proto "https"
	}
}

# HTTP listener
# - If the host matches the real domain, redirect to HTTPS
# - Otherwise (e.g., local dev without domain), just proxy over HTTP
:80 {
	@this host habittrackerdima.me
	handle @this {
		redir https://{host}{uri} permanent
	}

	handle {
		reverse_proxy nginx:80
	}
}
